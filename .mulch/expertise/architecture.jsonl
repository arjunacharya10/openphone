{"type":"decision","title":"Ship entire stack as Ubuntu Core snaps on a single device","rationale":"openphone-ui (Qt/QML), openphone-core (Fastify), and openclaw (AI agent) all run locally on the device as snaps. All inter-service communication is localhost. No cloud dependency for the core loop — only the LLM API and external integrations (Gmail, Calendar) need network.","recorded_at":"2026-02-22T04:35:24.861Z","classification":"tactical","id":"mx-198587"}
{"type":"reference","name":"Service ports and protocols","description":"openphone-core: port 3000, Fastify HTTP + WebSocket. openclaw gateway: port 18789, HTTP webhooks. openphone-ui connects to openphone-core via ws://localhost:3000/ws. openphone-core relays card actions to openclaw via POST http://localhost:18789/hooks/ui and /hooks/agent. openclaw calls back to openphone-core via POST http://localhost:3000/cards (inbound notify).","recorded_at":"2026-02-22T04:35:24.873Z","classification":"tactical","id":"mx-fd0cfb"}
{"type":"reference","name":"Monorepo structure","description":"apps/openphone-core (Node.js/Fastify), apps/openphone-ui (Qt/QML C++), contracts/ (shared TypeScript types), snaps/ (Ubuntu snap configs — empty), tooling/ (build scripts — empty). Git branch: master.","recorded_at":"2026-02-22T04:35:24.873Z","classification":"tactical","id":"mx-44b961"}
{"type":"decision","title":"Qt/QML for the device UI instead of a web stack","rationale":"Native rendering, no browser overhead, direct hardware access, fullscreen 480x960 form factor, and packages cleanly as a snap for Ubuntu Core with Ubuntu Frame as the Wayland compositor.","recorded_at":"2026-02-22T04:35:24.873Z","classification":"tactical","id":"mx-3b4adb"}
{"type":"decision","title":"Use @mariozechner/pi-ai as the LLM provider abstraction layer","rationale":"Public npm package (MIT, 251 versions, actively maintained) by the OpenClaw author. Provides a unified streamSimple() call across openai-completions, anthropic-messages, Google, Mistral, Bedrock, and Ollama shapes. Battle-tested in OpenClaw production. Model specified as provider/model string (e.g. anthropic/claude-opus-4-6, ollama/llama3.2). Avoids reinventing provider routing or depending on Vercel AI SDK.","classification":"tactical","recorded_at":"2026-02-22T05:36:31.228Z","id":"mx-7eb1cd"}
{"type":"decision","title":"Build agent loop directly in openphone-core, not using OpenClaw as runtime","rationale":"OpenClaw is designed for multi-channel messaging assistants (WhatsApp, Telegram, Slack). openphone is a dedicated device OS with a custom UI. Embedding the agent in openphone-core gives: one snap to maintain, no async callback complexity, full control over behavior, ownership over the stack shipped on device. OpenClaw repo used as reference for patterns only. Core LLM call is streamSimple() from @mariozechner/pi-ai.","classification":"tactical","recorded_at":"2026-02-22T05:36:37.213Z","id":"mx-01144d"}

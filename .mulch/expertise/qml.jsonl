{"type":"pattern","name":"Theme singleton for responsive scaling","description":"Theme.qml is a pragma Singleton registered via qmldir. All colors, font sizes, and spacing reference Theme.xxx — zero hardcoded values in components. Theme.scale = Math.min(windowWidth/480, windowHeight/960) makes all measurements responsive. Main.qml binds root.width/height to Theme.windowWidth/windowHeight on change.","recorded_at":"2026-02-22T04:35:46.178Z","classification":"tactical","id":"mx-c24d57"}
{"type":"pattern","name":"Modular QML directory structure","description":"qml/views/ contains full-screen containers (FocusView, LedgerView, CalendarView). qml/components/ contains reusable building blocks (ContextBand, InputBar, ActionButton, KindBadge, TimelineLine, WebSocketClient). All registered in qml.qrc. qmldir registers Theme as singleton.","recorded_at":"2026-02-22T04:35:46.189Z","classification":"tactical","id":"mx-e0230d"}
{"type":"pattern","name":"WebSocketClient as non-visual Item","description":"WebSocketClient.qml (in components/) owns the WS connection and all live ListModels. Exposes cardsModel, ledgerModel, calendarModel as ListModel properties. sendCardAction() and sendChatMessage() for outbound. Auto-reconnects every 3s on close/error via Timer. Data mapping happens at ingest: ISO timestamps → decimal hours for calendar, details.subject extraction for ledger, actionsJson as JSON string for cards.","recorded_at":"2026-02-22T04:35:46.189Z","classification":"tactical","id":"mx-7409e5"}
{"type":"convention","content":"FocusView receives property var card (null = empty state). Card actions stored as actionsJson string, parsed with JSON.parse() in Repeater model. Variant computed in QML: action==='dismiss' → dismiss, index===0 → primary, else secondary.","recorded_at":"2026-02-22T04:35:46.190Z","classification":"tactical","id":"mx-463da0"}
{"type":"reference","name":"Qt modules required","description":"openphone-ui.pro: QT += quick websockets. QML imports: QtQuick, QtQuick.Layouts, QtWebSockets. main.cpp loads qrc:/qml/Main.qml.","recorded_at":"2026-02-22T04:35:46.190Z","classification":"tactical","id":"mx-dc5496"}
{"type":"reference","name":"macOS Qt build output","description":"qmake + make produces openphone-ui.app bundle. Run via ./openphone-ui.app/Contents/MacOS/openphone-ui or double-click the app.","classification":"tactical","recorded_at":"2026-02-22T07:33:43.725Z","id":"mx-8d2f32"}
{"type":"convention","content":"Displayable card = first card with actions.length > 0. Cards without action items are not shown; main chat is displayed instead. getDisplayableCard() in Main.qml filters cardsModel. FocusView.card and InputBar cardId use this so chat routes to ui:chat:general when no actionable card.","classification":"tactical","recorded_at":"2026-02-22T16:59:30.859Z","id":"mx-7d4cb4"}
{"type":"convention","content":"FocusView layout: card at top (beginning of conversation), ChatArea below. When card is active, hide ChatArea 'Instruct or query' placeholder via showEmptyPlaceholder. Card-first flow establishes context before chat.","classification":"tactical","recorded_at":"2026-02-22T17:07:34.101Z","id":"mx-951261"}
{"type":"pattern","name":"full-page card chat carousel","description":"Each swipeable page = card header + that card's chat. WebSocketClient.getChatModelForCard(cardId) provides per-card ListModels; chat:delta/chat:response route by sessionKey. ApiClient.sessionHistoryFetched(sessionKey, messages) for per-session populate.","classification":"tactical","recorded_at":"2026-02-22T18:49:43.615Z","id":"mx-fc983b"}
{"type":"convention","content":"ApiClient.sessionHistoryFetched(sessionKey, messages) passes sessionKey so Main can route to populateChat (general) or populateChatForCard(cardId) for ui:chat:cardId sessions.","classification":"tactical","recorded_at":"2026-02-22T18:55:39.657Z","id":"mx-c1799b"}
{"type":"convention","content":"Ledger card detail is a separate view: StackLayout with list vs card-detail. Card detail shows chat, back button returns to ledger list. User can add 'next time do X' instructions; AI should persist via update_memory/update_user_context.","classification":"tactical","recorded_at":"2026-02-23T00:23:28.353Z","id":"mx-cf406f"}
{"type":"convention","content":"Settings view: 4th view (viewIndex 3). Profile card with avatar (initials), name/email/phone/bio (optional). SettingsRow for General, Gmail. InputBar hidden on Ledger and Settings.","classification":"tactical","recorded_at":"2026-02-23T20:07:01.343Z","id":"mx-0f0edb"}
{"type":"pattern","name":"Theme scale vs scaleFont DPI-aware","description":"Theme.scale for layout (spacing, radii) with floor 1.0. Theme.scaleFont for fonts, DPI-aware via Screen.pixelDensity (Main passes in onWidthChanged). Reference 480×960 @ 96 DPI. Prevents tiny UI on small/high-DPI screens.","classification":"tactical","recorded_at":"2026-02-23T23:48:18.697Z","id":"mx-141d6b"}
{"type":"pattern","name":"lock-screen-swipe-unlock","description":"Lock screen supports vertical swipe gesture (Flickable with DragOverBounds) as an alternative unlock affordance, reusing existing unlocked() signal.","classification":"tactical","recorded_at":"2026-02-24T22:11:09.225Z","id":"mx-e6bf57"}
{"type":"pattern","name":"lock-screen-swipe-sheet","description":"Lock screen implemented as full-screen sheet Item with explicit width/height so y can be dragged and animated; MouseArea tracks vertical drag to move sheet and triggers upward swipe to unlock with smooth slide-off animation before hiding via isLocked flag in Main.qml.","classification":"tactical","recorded_at":"2026-02-24T22:32:33.626Z","id":"mx-43e65e"}
{"type":"convention","content":"LockScreen.qml is used as a full-screen overlay in Main.qml, controlled by Window.isLocked; SettingsView emits lockRequested() via 'Lock Now' row to re-lock the UI.","classification":"tactical","recorded_at":"2026-02-24T22:32:33.626Z","id":"mx-5c5b9d"}
{"type":"pattern","name":"quick-settings-content-driven-layout","description":"Quick settings panel: root height = handleArea.height + margins + card.height; card height = cardContent.implicitHeight + padding (no anchors.fill on ColumnLayout so implicitHeight drives size); ControlTile inline component wraps each row; drag-close uses armed flag and mapToItem for coordinates.","classification":"tactical","recorded_at":"2026-02-25T00:23:46.650Z","id":"mx-dc060a"}
